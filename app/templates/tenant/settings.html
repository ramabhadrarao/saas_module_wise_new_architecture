{% extends 'layout/base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block page_title %}Tenant: {{ tenant.name }}{% endblock %}

{% block page_actions %}
<div class="btn-list">
    <a href="{{ url_for('tenant.index') }}" class="btn btn-outline-secondary">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path d="M9 14l-4 -4l4 -4"></path>
            <path d="M5 10h11a4 4 0 1 1 0 8h-1"></path>
        </svg>
        Back to Tenants
    </a>
    <a href="{{ url_for('tenant.edit', slug=tenant.slug) }}" class="btn btn-primary">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"></path>
            <path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z"></path>
            <path d="M16 5l3 3"></path>
        </svg>
        Edit Tenant
    </a>
</div>
{% endblock %}

{% block content %}
<div class="row row-cards">
    <div class="col-12 col-md-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Tenant Details</h3>
            </div>
            <div class="card-body">
                <div class="datagrid">
                    <div class="datagrid-item">
                        <div class="datagrid-title">Name</div>
                        <div class="datagrid-content">{{ tenant.name }}</div>
                    </div>
                    <div class="datagrid-item">
                        <div class="datagrid-title">Slug</div>
                        <div class="datagrid-content">{{ tenant.slug }}</div>
                    </div>
                    <div class="datagrid-item">
                        <div class="datagrid-title">Status</div>
                        <div class="datagrid-content">
                            {% if tenant.status == 'active' %}
                            <span class="badge bg-success">Active</span>
                            {% elif tenant.status == 'inactive' %}
                            <span class="badge bg-secondary">Inactive</span>
                            {% elif tenant.status == 'suspended' %}
                            <span class="badge bg-danger">Suspended</span>
                            {% elif tenant.status == 'provisioning' %}
                            <span class="badge bg-info">Provisioning</span>
                            {% elif tenant.status == 'decommissioning' %}
                            <span class="badge bg-warning">Decommissioning</span>
                            {% else %}
                            <span class="badge bg-secondary">{{ tenant.status }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="datagrid-item">
                        <div class="datagrid-title">Schema Name</div>
                        <div class="datagrid-content">
                            <code>{{ tenant.schema_name }}</code>
                        </div>
                    </div>
                    <div class="datagrid-item">
                        <div class="datagrid-title">Domain</div>
                        <div class="datagrid-content">
                            {% if tenant.domain %}
                            {{ tenant.domain }}
                            {% else %}
                            <span class="text-muted">Not set</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="datagrid-item">
                        <div class="datagrid-title">Owner Email</div>
                        <div class="datagrid-content">{{ tenant.owner_email }}</div>
                    </div>
                    <div class="datagrid-item">
                        <div class="datagrid-title">Plan</div>
                        <div class="datagrid-content">
                            <span class="badge bg-blue">{{ tenant.plan|capitalize }}</span>
                        </div>
                    </div>
                    <div class="datagrid-item">
                        <div class="datagrid-title">Created</div>
                        <div class="datagrid-content">{{ tenant.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
                    </div>
                    <div class="datagrid-item">
                        <div class="datagrid-title">Last Updated</div>
                        <div class="datagrid-content">{{ tenant.updated_at.strftime('%Y-%m-%d %H:%M') }}</div>
                    </div>
                </div>
            </div>
            {% if tenant.description %}
            <div class="card-footer">
                <div>
                    <h4 class="card-title">Description</h4>
                    <p>{{ tenant.description }}</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="col-12 col-md-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Resource Usage</h3>
            </div>
            <div class="card-body">
                <div class="mb-4">
                    <label class="form-label">Users ({{ tenant.usage.users }} / {{ tenant.quotas.max_users }})</label>
                    <div class="progress mb-2">
                        <div class="progress-bar bg-primary" style="width: {{ tenant.usage.users_percentage }}%" role="progressbar" aria-valuenow="{{ tenant.usage.users_percentage }}" aria-valuemin="0" aria-valuemax="100" aria-label="{{ tenant.usage.users_percentage }}% of users quota used">
                            <span class="visually-hidden">{{ tenant.usage.users_percentage }}% of users quota used</span>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <div>{{ tenant.usage.users_percentage }}% used</div>
                        <div class="ms-auto">
                            <a href="{{ url_for('tenant.quota', slug=tenant.slug) }}" class="btn btn-sm">View Details</a>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="form-label">Storage ({{ tenant.usage.storage_mb }} / {{ tenant.quotas.max_storage_mb }} MB)</label>
                    <div class="progress mb-2">
                        <div class="progress-bar bg-blue" style="width: {{ tenant.usage.storage_percentage }}%" role="progressbar" aria-valuenow="{{ tenant.usage.storage_percentage }}" aria-valuemin="0" aria-valuemax="100" aria-label="{{ tenant.usage.storage_percentage }}% of storage quota used">
                            <span class="visually-hidden">{{ tenant.usage.storage_percentage }}% of storage quota used</span>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <div>{{ tenant.usage.storage_percentage }}% used</div>
                        <div class="ms-auto">
                            <a href="{{ url_for('tenant.quota', slug=tenant.slug) }}" class="btn btn-sm">View Details</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <div class="d-flex">
                    <a href="{{ url_for('tenant.quota', slug=tenant.slug) }}" class="btn btn-outline-primary">
                        View Quota Details
                    </a>
                    <div class="ms-auto">
                        <a href="{{ url_for('tenant.edit', slug=tenant.slug) }}" class="btn">
                            Update Quotas
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h3 class="card-title">Tenant Actions</h3>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-6">
                        {% if tenant.status == 'active' %}
                        <form action="{{ url_for('tenant.update_status', slug=tenant.slug) }}" method="post">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <input type="hidden" name="status" value="inactive">
                            <button type="submit" class="btn btn-warning w-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M3 7m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z"></path>
                                    <path d="M9 11v6"></path>
                                    <path d="M15 11v6"></path>
                                </svg>
                                Deactivate Tenant
                            </button>
                        </form>
                        {% elif tenant.status == 'inactive' %}
                        <form action="{{ url_for('tenant.update_status', slug=tenant.slug) }}" method="post">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <input type="hidden" name="status" value="active">
                            <button type="submit" class="btn btn-success w-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M3 7m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z"></path>
                                    <path d="M9 15l3 -3l3 3"></path>
                                    <path d="M12 12v6"></path>
                                </svg>
                                Activate Tenant
                            </button>
                        </form>
                        {% endif %}
                    </div>
                    <div class="col-6">
                        {% if tenant.status != 'suspended' %}
                        <form action="{{ url_for('tenant.update_status', slug=tenant.slug) }}" method="post">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <input type="hidden" name="status" value="suspended">
                            <button type="submit" class="btn btn-danger w-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"></path>
                                    <path d="M12 8l0 4"></path>
                                    <path d="M12 16l.01 0"></path>
                                </svg>
                                Suspend Tenant
                            </button>
                        </form>
                        {% endif %}
                    </div>
                    <div class="col-6">
                        {% if tenant.status == 'suspended' %}
                        <form action="{{ url_for('tenant.update_status', slug=tenant.slug) }}" method="post">
                            
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <input type="hidden" name="status" value="active">
                            <button type="submit" class="btn btn-success w-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M9 12l2 2l4 -4"></path>
                                    <path d="M12 3a12 12 0 0 0 8.5 3a12 12 0 0 1 -8.5 15a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3"></path>
                                </svg>
                                Activate Tenant
                            </button>
                        </form>
                        {% endif %}
                    </div>
                    <div class="col-12">
                        <form action="{{ url_for('tenant.delete', slug=tenant.slug) }}" method="post" class="delete-form" data-confirm="Are you sure you want to delete this tenant? This action cannot be undone and will permanently delete all tenant data.">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-outline-danger w-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M4 7l16 0"></path>
                                    <path d="M10 11l0 6"></path>
                                    <path d="M14 11l0 6"></path>
                                    <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"></path>
                                    <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"></path>
                                </svg>
                                Delete Tenant
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Handle confirmation dialogs for delete forms
        document.querySelectorAll('.delete-form').forEach(form => {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const message = this.dataset.confirm || 'Are you sure?';
                
                if (confirm(message)) {
                    this.submit();
                }
            });
        });
    });
</script>
{% endblock %}